<!doctype>
<html>

<head>
    <title>abi2html</title>
    <link rel="stylesheet" href="index.css">
    <script type="text/javascript" src="./dist/bignumber.min.js"></script>
    <script type="text/javascript" src="./dist/web3-light.js"></script>
    <script type="text/javascript" src="./abi2html.js"></script>
    <script type="text/javascript">
    // Address of the contract with this ABI
    var address = '0x63f33b08404987648ce2dde79715e14e8b69e4d8'

    // ABI output from Solidity compiler
    var abiString = '[{"constant":false,"inputs":[{"name":"_owner","type":"address"}],"name":"removeOwner","outputs":[],"type":"function"},{"constant":false,"inputs":[{"name":"_addr","type":"address"}],"name":"isOwner","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"m_numOwners","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[],"name":"resetSpentToday","outputs":[],"type":"function"},{"constant":false,"inputs":[{"name":"_owner","type":"address"}],"name":"addOwner","outputs":[],"type":"function"},{"constant":true,"inputs":[],"name":"m_required","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[{"name":"_h","type":"bytes32"}],"name":"confirm","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[{"name":"_newLimit","type":"uint256"}],"name":"setDailyLimit","outputs":[],"type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_value","type":"uint256"},{"name":"_data","type":"bytes"}],"name":"execute","outputs":[{"name":"_r","type":"bytes32"}],"type":"function"},{"constant":false,"inputs":[{"name":"_operation","type":"bytes32"}],"name":"revoke","outputs":[],"type":"function"},{"constant":false,"inputs":[{"name":"_newRequired","type":"uint256"}],"name":"changeRequirement","outputs":[],"type":"function"},{"constant":true,"inputs":[{"name":"_operation","type":"bytes32"},{"name":"_owner","type":"address"}],"name":"hasConfirmed","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address"}],"name":"kill","outputs":[],"type":"function"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_to","type":"address"}],"name":"changeOwner","outputs":[],"type":"function"},{"constant":true,"inputs":[],"name":"m_dailyLimit","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"inputs":[{"name":"identifier","type":"bytes32"}],"type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"identifier","type":"bytes32"}],"name":"Created","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"owner","type":"address"},{"indexed":false,"name":"operation","type":"bytes32"}],"name":"Confirmation","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"owner","type":"address"},{"indexed":false,"name":"operation","type":"bytes32"}],"name":"Revoke","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"oldOwner","type":"address"},{"indexed":false,"name":"newOwner","type":"address"}],"name":"OwnerChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"newOwner","type":"address"}],"name":"OwnerAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"oldOwner","type":"address"}],"name":"OwnerRemoved","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"newRequirement","type":"uint256"}],"name":"RequirementChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"from","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Deposit","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"owner","type":"address"},{"indexed":false,"name":"value","type":"uint256"},{"indexed":false,"name":"to","type":"address"},{"indexed":false,"name":"data","type":"bytes"}],"name":"SingleTransact","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"owner","type":"address"},{"indexed":false,"name":"operation","type":"bytes32"},{"indexed":false,"name":"value","type":"uint256"},{"indexed":false,"name":"to","type":"address"},{"indexed":false,"name":"data","type":"bytes"}],"name":"MultiTransact","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"operation","type":"bytes32"},{"indexed":false,"name":"initiator","type":"address"},{"indexed":false,"name":"value","type":"uint256"},{"indexed":false,"name":"to","type":"address"},{"indexed":false,"name":"data","type":"bytes"}],"name":"ConfirmationNeeded","type":"event"}]'

    // Settable properties to override default behavior
    var properties = {
        events: {
            watchCallback: function(err, results, htmlDoc) {
                if (err) {
                    var p = document.createElement('p')
                    p.innerHTML = err
                    p.className = 'warning'
                    document.getElementById('events').appendChild(p)
                } else {
                    console.log(results)
                    document.getElementById('events').appendChild(htmlDoc)
                }
            },
            renderCallback: function(err, results, htmlDoc) {
                if (err)
                    alert(err)
                else {
                    document.getElementById('events').appendChild(htmlDoc)
                }
            },
        },
        functions: {
            callFunction: function(v) {
                alert('custom call function!')
            },
            callButtonText: 'Read',
            transactButtonText: 'Publish',
            outputFieldsetName: '',
            renderCallback: function(htmlDoc) {
                document.getElementById('functions').appendChild(htmlDoc)
            }
        }
    }

    var connectInstance = function(ip, port) {
        if (!ip) ip = '127.0.0.1'
        if (!port) port = '8545'

        if (!web3.currentProvider)
            web3.setProvider(new web3.providers.HttpProvider('http://' + ip + ':' + port));

        try {
            web3.eth.accounts;
        } catch (e) {
            console.log('Could not connect to instance')
            return false
        }
        return true
    }

    window.onload = function() {
        connectInstance()

        // Instantiate library with abi and optional properties
        var abihtml = new AbiHtml(abiString, properties);

        abihtml.functions.forEach(function(func) {
            func.generateHtml()
        })
        abihtml.events.forEach(function(ev) {
            ev.watch(address)
                // ev.generateHtml()
        })
    }

    window.onbeforeunload = function() {
        // doc.events.forEach(function(ev) {
        //     ev.filter.stopWatching()
        // })
    }
    </script>
</head>

<body>
    <div id="wrapper">
        <div id="head">
            &nbsp;
        </div>
        <div id="top">
            &nbsp;
        </div>
        <div id="bottom">
            <div id="main">
                <div id="functions"></div>
            </div>
            <div id="status">
                <div id="events"></div>
            </div>
        </div>
        <div id="foot">
        </div>
    </div>
</body>

</html>
