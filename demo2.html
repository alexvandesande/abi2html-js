<!doctype>
<html>

<head>
    <title>abi2html</title>
    <link rel="stylesheet" href="index.css">
    <script type="text/javascript" src="./dist/bignumber.min.js"></script>
    <script type="text/javascript" src="./dist/web3-light.min.js"></script>
    <script type="text/javascript" src="./lib/abi2html.js"></script>
    <script type="text/javascript">
    window.onload = function() {
        // convenience variables
        var fromAddress = '0x392af429f1b9537f28d97b8467e4b4e3498d5108'
        var abiString = document.getElementById('contract-abi').value

        // dev doce block for testing outside Mist
        if (!web3.currentProvider)
            web3.setProvider(new web3.providers.HttpProvider('http://127.0.0.1:8545'))

        try {
            web3.eth.accounts
            console.log('Connected')
        } catch (e) {
            console.log('Could not connect to instance')
        }

        // Instantiate library with abi and optional properties
        var abihtml = new AbiHtml(abiString)

        // render functions
        abihtml.RenderFunctions({
            to: document.getElementById('contract-address').value,
            from: fromAddress,
            gas: 3000000,
            gasPrice: web3.eth.gasPrice
        }, function(htmlDom) {
            document.getElementById('functions').appendChild(htmlDom)
        })

        // watch event history
        abihtml.GetEvents({
            address: document.getElementById('contract-address').value,
        }, {}, function(htmlDom) {
            document.getElementById('events').appendChild(htmlDom)
        })

        // watch events
        abihtml.WatchEvents({
            address: document.getElementById('contract-address').value,
        }, {}, function(htmlDom) {
            var el = document.getElementById('events')
            el.insertBefore(htmlDom, el.childNodes[0])
        })

    }

    window.onbeforeunload = function() {
        // doc.events.forEach(function(ev) {
        //     ev.filter.stopWatching()
        // })
    }
    </script>
</head>

<body>
    <div id="wrapper">
        <div id="head">
            &nbsp;
        </div>
        <div id="top">
            <div class="pull-left">
                <label for="contract-abi" class="clearboth">Contract ABI:</label>
                <textarea id="contract-abi" class="clearboth">[{"constant":false,"inputs":[{"name":"_owner","type":"address"}],"name":"removeOwner","outputs":[],"type":"function"},{"constant":true,"inputs":[{"name":"_addr","type":"address"}],"name":"isOwner","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"m_numOwners","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[],"name":"resetSpentToday","outputs":[],"type":"function"},{"constant":false,"inputs":[{"name":"_owner","type":"address"}],"name":"addOwner","outputs":[],"type":"function"},{"constant":true,"inputs":[],"name":"m_required","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"constant":false,"inputs":[{"name":"_h","type":"bytes32"}],"name":"confirm","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[{"name":"_newLimit","type":"uint256"}],"name":"setDailyLimit","outputs":[],"type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_value","type":"uint256"},{"name":"_data","type":"bytes"}],"name":"execute","outputs":[{"name":"_r","type":"bytes32"}],"type":"function"},{"constant":false,"inputs":[{"name":"_operation","type":"bytes32"}],"name":"revoke","outputs":[],"type":"function"},{"constant":false,"inputs":[{"name":"_newRequired","type":"uint256"}],"name":"changeRequirement","outputs":[],"type":"function"},{"constant":true,"inputs":[{"name":"_operation","type":"bytes32"},{"name":"_owner","type":"address"}],"name":"hasConfirmed","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address"}],"name":"kill","outputs":[],"type":"function"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_to","type":"address"}],"name":"changeOwner","outputs":[],"type":"function"},{"constant":true,"inputs":[],"name":"m_dailyLimit","outputs":[{"name":"","type":"uint256"}],"type":"function"},{"inputs":[{"name":"identifier","type":"bytes32"}],"type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"identifier","type":"bytes32"}],"name":"Created","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"owner","type":"address"},{"indexed":false,"name":"operation","type":"bytes32"}],"name":"Confirmation","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"owner","type":"address"},{"indexed":false,"name":"operation","type":"bytes32"}],"name":"Revoke","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"oldOwner","type":"address"},{"indexed":false,"name":"newOwner","type":"address"}],"name":"OwnerChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"newOwner","type":"address"}],"name":"OwnerAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"oldOwner","type":"address"}],"name":"OwnerRemoved","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"newRequirement","type":"uint256"}],"name":"RequirementChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"from","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Deposit","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"owner","type":"address"},{"indexed":false,"name":"value","type":"uint256"},{"indexed":false,"name":"to","type":"address"},{"indexed":false,"name":"data","type":"bytes"}],"name":"SingleTransact","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"owner","type":"address"},{"indexed":false,"name":"operation","type":"bytes32"},{"indexed":false,"name":"value","type":"uint256"},{"indexed":false,"name":"to","type":"address"},{"indexed":false,"name":"data","type":"bytes"}],"name":"MultiTransact","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"operation","type":"bytes32"},{"indexed":false,"name":"initiator","type":"address"},{"indexed":false,"name":"value","type":"uint256"},{"indexed":false,"name":"to","type":"address"},{"indexed":false,"name":"data","type":"bytes"}],"name":"ConfirmationNeeded","type":"event"}]</textarea>
            </div>
            <div class="pull-right">
                <label for="contract-address" class="clearboth">Contract address:</label>
                <input type="text" id="contract-address" class="address clearboth" value="0x63f33b08404987648ce2dde79715e14e8b69e4d8">
            </div>
        </div>
        <div id="bottom">
            <div id="main">
                <div id="functions"></div>
            </div>
            <div id="status">
                <div id="events"></div>
            </div>
        </div>
        <div id="foot">
        </div>
    </div>
</body>

</html>
