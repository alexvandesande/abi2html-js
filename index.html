<!doctype>
<html>

<head>
    <title>abi2html</title>
    <link rel="stylesheet" href="index.css">
    <script type="text/javascript" src="./dist/bignumber.min.js"></script>
    <script type="text/javascript" src="./dist/web3-light.js"></script>
    <script type="text/javascript" src="./abiHtml.js"></script>
    <script type="text/javascript" src="./abiReader.js"></script>
    <script type="text/javascript">
    // initalize web3
    var web3 = require('web3');
    var contracts;
    // set global events
    window.onload = function() {
        // set event handlers
        document.getElementById('send_value').addEventListener('click', sendValue, false);

        document.getElementById('sender_address').addEventListener('change', function() {
            renderAccountBalance('sender_balance', getBalance(getSenderAddress()))
        }, false);

        document.getElementById('gas_price_unit').addEventListener('change', function() {
            renderGasPriceEstimate(networkGasPrice)
        }, false);

        document.getElementById('compile-contract').addEventListener('click', function() {
            compileSolidity(document.getElementById('contract-code').value, function(err, r) {
                if (err)
                    alert(err)
                else {
                    contracts = r
                    setContractSelector('contract-selector', r)
                    renderContractInfo('contract-abi', getSelectedContract('contract-selector'))
                    generateDoc(false);
                }
            })

        }, false);

        document.getElementById('contract-selector').addEventListener('change', function(){
            renderContractInfo('contract-abi', getSelectedContract('contract-selector'))
            generateDoc(false);
        })

        document.getElementById('deploy-contract').addEventListener('click', function(){
            contract = getSelectedContract('contract-selector')
            deployContract(contract.code, function(error, result){
                if (!error)
                    renderTransactionHash(result)
                else
                    alert(error)
            })
        }, false);

        document.getElementById('connect-instance').addEventListener('click', function() {
            if (!connectInstance(getInstanceHostname(), getInstancePort())) {
                alert('could not connect to ethereum client')
            } else {
                getNetworkGasPrice(renderGasPriceEstimate);
                getAccounts('sender_address', updateBalances);
                monitorBlocks()
                document.getElementById('compile-contract').disabled = false
                document.getElementById('deploy-contract').disabled = false
                document.getElementById('monitor-events').disabled = false
                document.getElementById('send_value').disabled = false
            }
        }, false);

        document.getElementById('generate-page').addEventListener('click', function() {
            generateDoc(false)
        }, false);

        document.getElementById('monitor-events').addEventListener('click', function() {
            monitorBlocks()
            generateDoc(true)
        }, false);
    }

    window.onbeforeunload = function() {
        // unlikely this fires, but try to clean up after oneself
        unset()
    }
    </script>
</head>

<body>
    <div id="head">
        <p>
            <samp>geth --rpc --rpcaddr "</samp>
            <input type="text" id="instance-hostname" value="127.0.0.1">
            <samp>" --rpcport "
                <input type="text" id="instance-port" value="8545">" --rpccorsdomain "*" --unlock "&lt;ACCOUNT1&gt; &lt;ACCOUNT2&gt; &lt;ACCOUNT3&gt;"</samp>
        </p>
        <div id="local">
            <label for="sender_address">From:</label>
            <select id="sender_address" class="in_address"></select>
            <br> Account balance: <span id="sender_balance">0</span>
            <div>
                <label for="contract-code">Contract</label>
                <br>
                <textarea id="contract-code"></textarea>
                <button type="button" id="connect-instance">Connect</button>
                <button type="button" id="compile-contract" disabled>Compile</button>
            </div>
        </div>
        <div id="net">
            <em>account must be unlocked!</em>
            <br>
            <label for="gas">Gas:</label>
            <input id="gas" type="text" class="" value="3000000">
            <br>
            <label for="gas_price">Gas price:</label>
            <input id="gas_price" type="text" class="" value="10">
            <select id="gas_price_unit">
                <option>ether</option>
                <option>finney</option>
                <option selected>szabo</option>
                <option>shannon</option>
                <option>babbage</option>
                <option>ada</option>
                <option>wei</option>
            </select>
            <br>
            <em>Estimated from network</em>
            <br>
            <label for="ether_amt">&#926;</label>
            <input id="ether_amt" type="text" value="0">
            <button id="send_value" type="button" disabled>Send</button>
            <hr>
            <select id="contract-selector"></select>
            <button type="button" id="deploy-contract" disabled>Deploy</button>
            <br>
            <label for="transaction-hash">Transaction hash:</label>
            <input id="transaction-hash" type="text" class="in_address">

        </div>
        <div id="remote">
            <label for="contract_address">Contract address:</label>
            <input id="contract_address" type="text" class="in_address">
            <br>
            <label for="contract_balance">Balance:</label>
            <span id="contract_balance"></span>
            <br> Contract ABI:
            <br>
            <textarea id="contract-abi">
            </textarea>
            <button type="button" id="generate-page">Generate</button>
            <button type="button" id="monitor-events" disabled>Monitor</button>
        </div>
    </div>
    <div id="main">
        <div id="functions"></div>
        <div id="events"></div>
    </div>
    <div id="foot">
    </div>
</body>

</html>
